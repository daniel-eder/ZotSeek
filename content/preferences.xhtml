<vbox id="zotseek-preferences" onload="Zotero.ZotSeek?.hooks.onPrefsEvent('load', {window, id: 'general'})"
  onunload="Zotero.ZotSeek?.hooks.onPrefsEvent('unload', {window, id: 'general'})">

  <!-- Index Statistics -->
  <groupbox>
    <label>
      <html:h2>Index Statistics</html:h2>
    </label>

    <html:div style="display: grid; grid-template-columns: 140px 1fr; gap: 4px 12px; margin: 8px 0;">
      <html:span style="color: #666;">Indexed Papers:</html:span>
      <html:span id="zotseek-stat-papers" style="font-weight: 500;">-</html:span>

      <html:span style="color: #666;">Total Chunks:</html:span>
      <html:span id="zotseek-stat-chunks" style="font-weight: 500;">-</html:span>

      <html:span style="color: #666;">Avg Chunks/Paper:</html:span>
      <html:span id="zotseek-stat-avgchunks" style="font-weight: 500;">-</html:span>

      <html:span style="color: #666;">Storage Used:</html:span>
      <html:span id="zotseek-stat-storage" style="font-weight: 500;">-</html:span>

      <html:span style="color: #666;">Database Path:</html:span>
      <html:span id="zotseek-stat-dbpath" style="font-weight: 500; font-size: 11px; word-break: break-all;">-
      </html:span>

      <html:span style="color: #666;">Model:</html:span>
      <html:span id="zotseek-stat-model" style="font-weight: 500;">-</html:span>

      <html:span style="color: #666;">Last Indexed:</html:span>
      <html:span id="zotseek-stat-lastindexed" style="font-weight: 500;">-</html:span>

      <html:span id="zotseek-stat-duration-label" style="display: none; color: #666;">Index Duration:</html:span>
      <html:span id="zotseek-stat-duration" style="display: none; font-weight: 500;">-</html:span>

      <html:span id="zotseek-stat-indexedmode-label" style="display: none; color: #666;">Indexed With Mode:</html:span>
      <html:span id="zotseek-stat-indexedmode" style="display: none; font-weight: 500;">-</html:span>
    </html:div>

    <hbox>
      <button id="zotseek-refresh-stats" label="Refresh Stats" />
    </hbox>
  </groupbox>

  <!-- Indexing Mode Mismatch Warning -->
  <html:div id="zotseek-indexmode-warning"
    style="display: none; background-color: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; padding: 12px; margin-bottom: 12px;">
    <html:strong style="color: #856404;">⚠️ Index Mode Mismatch</html:strong>
    <html:p style="color: #856404; margin: 8px 0 4px 0;">
      Your index was built with <html:strong id="zotseek-warning-indexed-mode">Full Paper</html:strong> mode,
      but your current setting is <html:strong id="zotseek-warning-current-mode">Abstract Only</html:strong>.
    </html:p>
    <html:p style="color: #856404; margin: 4px 0;">
      Click "Rebuild Index" below to apply your new indexing mode setting.
    </html:p>
  </html:div>

  <!-- Indexing Settings -->
  <groupbox>
    <label>
      <html:h2>Indexing</html:h2>
    </label>

    <hbox align="center">
      <label value="Index content:" style="min-width: 180px;" />
      <menulist id="zotseek-pref-indexingMode" native="true" style="min-width: 200px;">
        <menupopup>
          <menuitem label="Abstract only (faster)" value="abstract" />
          <menuitem label="Full paper (more thorough)" value="full" />
        </menupopup>
      </menulist>
    </hbox>

    <vbox style="margin-top: 8px; padding: 8px; background: #f5f5f5; border-radius: 4px;">
      <html:p style="margin: 0 0 4px 0; font-weight: 500;">Mode comparison:</html:p>
      <html:p style="margin: 0; font-size: 11px; color: #555;">
        <html:b>Abstract only:</html:b> Indexes title + abstract. Fast indexing,
        works well for most searches. ~1 chunk per paper.
      </html:p>
      <html:p style="margin: 4px 0 0 0; font-size: 11px; color: #555;">
        <html:b>Full paper:</html:b> Also indexes Methods and Results sections from PDFs.
        Better for finding specific methodologies or detailed findings. ~3 chunks per paper.
      </html:p>
    </vbox>

    <separator class="thin" />

    <hbox align="center">
      <label value="Max Tokens per Chunk:" style="min-width: 180px;" />
      <html:input type="number" id="zotseek-pref-maxTokens" min="1000" max="8000" step="500" value="7000"
        style="width: 80px;" />
      <label value="(1000-8000)" style="margin-left: 8px; color: #666;" />
    </hbox>

    <hbox align="center">
      <label value="Max Chunks per Paper:" style="min-width: 180px;" />
      <html:input type="number" id="zotseek-pref-maxChunksPerPaper" min="1" max="5" step="1" value="5"
        style="width: 80px;" />
      <label value="(1-5)" style="margin-left: 8px; color: #666;" />
    </hbox>

    <html:p style="color: #666; font-size: 11px; margin: 8px 0;">
      Using nomic-embed-text-v1.5 with 8192 token context window.
      Most papers need only 1-3 chunks.
    </html:p>
  </groupbox>

  <!-- Embedding Model Settings -->
  <groupbox>
    <label>
      <html:h2>Embedding Provider</html:h2>
    </label>

    <hbox align="center">
      <label value="Provider:" style="min-width: 180px;" />
      <menulist id="zotseek-pref-embeddingProvider" native="true" style="min-width: 200px;">
        <menupopup>
          <menuitem label="Local (Transformers.js)" value="local" />
          <menuitem label="OpenAI" value="openai" />
          <menuitem label="Google Gemini" value="google" />
          <menuitem label="Custom / Generic OpenAI-compatible" value="generic" />
        </menupopup>
      </menulist>
    </hbox>

    <hbox align="center" id="zotseek-pref-box-embeddingModel">
      <label value="Model ID:" style="min-width: 180px;" />
      <html:input type="text" id="zotseek-pref-embeddingModel" style="flex: 1; min-width: 200px;" />
    </hbox>

    <hbox align="center" id="zotseek-pref-box-apiEndpoint" style="display: none;">
      <label value="API Endpoint:" style="min-width: 180px;" />
      <html:input type="text" id="zotseek-pref-apiEndpoint" style="flex: 1; min-width: 200px;" />
    </hbox>

    <hbox align="center" id="zotseek-pref-box-apiKey" style="display: none;">
      <label value="API Key:" style="min-width: 180px;" />
      <html:input type="password" id="zotseek-pref-apiKey" style="flex: 1; min-width: 200px;" />
    </hbox>

    <html:div id="zotseek-embedding-warning"
      style="display: none; background-color: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; padding: 8px; margin-top: 8px;">
      <html:span style="color: #856404; font-size: 11px;">
        ⚠️ Changing provider or model ID requires a full <html:strong>Rebuild Index</html:strong> to work correctly.
      </html:span>
    </html:div>
  </groupbox>


  <!-- Search Settings -->
  <groupbox>
    <label>
      <html:h2>Search</html:h2>
    </label>

    <hbox align="center">
      <label value="Maximum Results:" style="min-width: 180px;" />
      <html:input type="number" id="zotseek-pref-topK" min="5" max="100" step="5" value="20" style="width: 80px;" />
      <label value="(5-100)" />
    </hbox>

    <hbox align="center">
      <label value="Minimum Similarity (%):" style="min-width: 180px;" />
      <html:input type="number" id="zotseek-pref-minSimilarity" min="0" max="100" step="5" value="30"
        style="width: 80px;" />
      <label value="(0-100)" />
    </hbox>

    <separator class="thin" />

    <hbox align="center">
      <checkbox id="zotseek-pref-excludeBooks" label="Exclude books from indexing and search" checked="true" />
      <label value="(books lack paper sections and are too long to index well)"
        style="margin-left: 8px; color: #666;" />
    </hbox>
  </groupbox>

  <!-- Actions -->
  <groupbox>
    <label>
      <html:h2>Actions</html:h2>
    </label>

    <hbox>
      <button id="zotseek-clear-index" label="Clear Index" style="margin-right: 8px;" />
      <button id="zotseek-rebuild-index" label="Rebuild Index" style="font-weight: 600; margin-right: 8px;" />
      <button id="zotseek-update-index" label="Update Index" />
    </hbox>

    <html:p style="color: #666; font-size: 11px; margin: 4px 0 8px 0;">
      <html:strong>Clear Index:</html:strong> Remove all embeddings.
      <html:br />
      <html:strong>Rebuild Index:</html:strong> Clear and re-index with current settings (recommended after changing
      mode).
      <html:br />
      <html:strong>Update Index:</html:strong> Index all unindexed items in your library.
    </html:p>
  </groupbox>

  <!-- About -->
  <groupbox>
    <label>
      <html:h2>About</html:h2>
    </label>
    <hbox>
      <label class="zotero-text-link" is="zotero-text-link" role="link" href="https://github.com/daniel-eder/zotseek"
        value="GitHub Repository" />
    </hbox>
  </groupbox>

</vbox>